---
title: "二叉查找树在Java中的实现"
subtitle: "红黑树"
date: 2019-01-13
categories: [algorithm]
tags: [tree, Java, source code]
---

为了提高搜索效率，很多学界大佬都为此奉献了他们的时间和智慧，创造了一系列优秀都算法和数据结构，其中二叉查找树在很多场景下都有应用。本文主要介绍二叉查找树以及它在 Java 中的实现——红黑树。

### 二叉查找树

二叉查找树，它或者是一棵空树，或者是具有以下性质的二叉树：

- 每个结点都有一个作为查找依据的关键码`key`，所有结点的关键码互不相同。
- 左子树（如果非空）上所有结点的关键码都小于根结点的关键码。
- 右子树（如果非空）上所有结点的关键码都大于根结点的关键码。
- 左子树和右子树也是二叉查找树。

如果对一棵二叉查找树进行中序遍历，可以将各结点的关键码按从小到大排序。依靠二叉查找树左子树小于根右子树大于根的性质，可以提高查找效率，但是查找效率是和树的高度相关的。即使同一组数据，生成的二叉查找树也可以有多种结构，最坏情况下可能出现所有父结点只有左（右）子树的结构。

### AVL 树

AVL 树是由俄罗斯数学家G.M.Adelson-Velsky和E.M.Landis提出的，主要目的就是为了提高二叉查找树的效率。AVL 树是高度平衡的二叉查找树，因此也被成为平衡二叉树。

对于高度平衡的定义是这样的：左右子树都是高度平衡，且左右子树的高度差的绝对值不超过1。对于结点个数为n的 AVL 树，其高度大概为$\\log_2 n$，所以其平均查找长度可保持在$O(\\log_2 n)$。

对 AVL 树进行插入操作时，有可能导致树对高度平衡性被破坏，对于这种情况，需要根据树不同的形态采取不同的旋转策略进行调整。

- 左单旋转（RotationLchild）
- 右单旋转（RotationRchild）
- 先左后右双旋转（RotationLchildRchild）
- 先右后左双旋转（RotationRchildLchild）

AVL 树的旋转操作过于复杂，我想这可能是导致 AVL 并没有被大量采用的原因之一，但是了解它的原理对我们掌握其他查找树很有启发意义。例如后面提到的红黑树，它的插入操作也会用到类似于 AVL 树的旋转操作。

### $B$树

$B$树是建立索引常用的数据结构，$B^+$树和$B^\*$树都是由$B-$树发展而来。一棵 m 阶$B$树是一棵高度平衡的 m 叉查找树，它或者是空树，或者是满足下列性质的树：

- 每个结点最多有 m 棵子树，并具有如下结构，其中，n 是结点内关键码的实际个数，$P_i$是指向子树的指针，$0 \leq i \leq n < m$；$K_i$是关键码，$1 \leq i \leq n < m$，$K_i < K_{i+1}$，$1 \leq i < n$：

$$n,P_0,K_1,P_1,K_2,P_2,\cdots,K_n,P_n$$

- 跟结点至少有两个子女；除根结点外的所有结点至少有$\lceil \frac{m}{2} \rceil$个子结点。
- 在子树$P_i$中所有关键码都小于$K_{i+1}$，且大于$K_i$，$0 < i < n$；在子树$P_n$中所有的关键码都大于$K_n$。
- 所有失败结点都位于同一层，它们都是查找失败（树中不包含的关键码）查找指针到达的结点。失败结点都为空结点，指向它们的指针都为空。

![3阶B树][picture 1]

当$m = 3$时，$B$树中除了叶子（也就是失败结点）外的其他结点的度（结点的子树个数）可以为2或3；当$m = 4$时，可以为2、3或4。因此3阶$B$树也称为 2-3 树，4阶$B$树也称为 2-3-4 树。

### 红黑树

红黑树在形态上是二叉树，但是逻辑上是4阶$B$树（2-3-4查找树）。红黑树通过结点的着色进行逻辑上的层的划分（即红色结点与其黑色父结点属于同一层），它是二叉查找树并且着色方式应满足以下性质：

- 每个结点或者是红色的，或者是黑色的。
- 根结点一定是黑色的。
- 所有扩充的外结点（叶子结点）都是黑色的。
- 如果一个内结点是红色的，那么它的子结点是黑色的。
- 所有结点到它的各个子孙外结点的路径包含相同数目的黑色结点。

在上述性质中，内结点为非叶子结点，它们都包含一个关键码；外结点为叶子结点，它们都是空的结点，是在查找失败的情况下到达的结点，也称为失败结点。在红黑树中，从任一结点 x 出发，到达外结点的路径上的的黑结点个数（不包括结点 x）叫做结点 x 的黑高度，也称为结点 x 的阶（rank）。下图是一个红黑树的示例：

![红黑树][picture 2]

红黑树可以根据着色情况，转化为2-3-4查找树，也就是说，红黑树和2-3-4查找树在逻辑上是等价的，例如将上图中的红黑树转化为2-3-4查找树：

![红黑树转化为4阶B树][picture 3]

从上图中我们可以看出，所有红色结点可以和其父结点（黑色）结合为一个$B$树结点，通过这种转化，一个红黑树转变为一棵$B$树，同时，红黑树的外结点变为了$B$树中的失败结点。

### 红黑树的插入操作

### 红黑树的删除操作

[picture 1]: /images/algorithm/2019-01-13-红黑树/3阶B树.jpg "3 阶 B 树"
[picture 2]: /images/algorithm/2019-01-13-红黑树/红黑树.jpg "红黑树"
[picture 3]: /images/algorithm/2019-01-13-红黑树/红黑树转化为4阶B树.jpg "红黑树转化为 4 阶 B 树"
